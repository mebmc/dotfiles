# TMUX keybindings configuration

# 0 is too far from ` ;)
set -g base-index 1
set -g detach-on-destroy off

# unbinds

unbind -T root C-h
unbind -T root C-l
unbind -T root C-Down
unbind -T root M-Up
unbind -T root M-Down
unbind -T root C-Space

# Reload TMUX configuration

bind-key                    r                   source-file ~/.tmux.conf \; display-message "Config reloaded..."

# Swicth to last window

bind-key                    q                   last-window

# Manage Sessions
bind-key                    C                   command-prompt "new-session -s '%%'"
bind-key                    W                   choose-session
bind-key                    <                   command-prompt "rename-session '%%'"

# Manage Windows
bind-key                    w                   choose-tree -F "#{window_name}"
#bind-key                    w                   choose-window
bind-key                    c                   new-window -c "#{session_path}"
bind-key                    %                   splitw -h -c "#{pane_current_path}"
bind-key                    '"'                 splitw -c "#{pane_current_path}"

# Stuff

bind-key -r                 o                   send-key " whmapi1 create_user_session user=root service=whostmgrd | grep url | awk -F'url: ' '{ print $2 }'"

# Navigate windows

bind-key -r -T root         C-Left              select-window -t :-
bind-key -r -T root         C-Right             select-window -t :+
bind-key -r -T prefix       p                   select-window -t :-
bind-key -r -T prefix       n                   select-window -t :+

# Select panes

bind-key -r -T root         M-Up                select-pane -U
bind-key -r -T root         M-Down              select-pane -D
bind-key -r -T root         M-Left              select-pane -L
bind-key -r -T root         M-Right             select-pane -R

bind-key    -T prefix       j                   select-pane -U
bind-key    -T prefix       k                   select-pane -D
bind-key    -T prefix       h                   select-pane -L
bind-key    -T prefix       l                   select-pane -R

# Resize panes

bind-key -r -T root         C-S-Up              resize-pane -U
bind-key -r -T root         C-S-Down            resize-pane -D
bind-key -r -T root         C-S-Left            resize-pane -L
bind-key -r -T root         C-S-Right           resize-pane -R

bind-key -r -T prefix       J                   resize-pane -U
bind-key -r -T prefix       K                   resize-pane -D
bind-key -r -T prefix       H                   resize-pane -L
bind-key -r -T prefix       L                   resize-pane -R

# Swap panes

#bind-key    -T root         C--                 swap-window -t -1; select-window -t :-
#bind-key    -T root         C-+                 swap-window -t +1; select-window -t :+

# Mark panes

bind-key    -T root         M-=                 select-pane -m
bind-key    -T root         M--                 break-pane
bind-key    -T root         M-+                 join-pane

# Copy mode

bind-key    -T prefix         \                 copy-mode -e
bind-key    -T root         C-\                 copy-mode -e
bind-key    -T prefix       [                   copy-mode -e
bind-key    -T prefix       ]                   paste-buffer

bind-key    -T root         C-Down              run-shell ""
bind-key    -T root         C-Up                copy-mode -e -u
bind-key    -T copy-mode    C-Down              send-keys -X page-down
bind-key    -T copy-mode    C-Up                send-keys -X page-up

bind-key    -T root         C-NPage               run-shell ""
bind-key    -T root         C-PPage               copy-mode -e -u
bind-key    -T copy-mode    NPage               send-keys -X page-down
bind-key    -T copy-mode    PPage               send-keys -X page-up

# Copy mode search

bind-key    -T copy-mode    /                   command-prompt -i -I "#{pane_search_string}" -p "(search up)" "send -X search-backward-incremental \"%%%\""
bind-key    -T copy-mode    ?                   command-prompt -i -I "#{pane_search_string}" -p "(search down)" "send -X search-forward-incremental \"%%%\""
bind-key    -T copy-mode    C-r                 command-prompt -i -I "#{pane_search_string}" -p "(search up)" "send -X search-backward-incremental \"%%%\""
bind-key    -T copy-mode    C-s                 command-prompt -i -I "#{pane_search_string}" -p "(search down)" "send -X search-forward-incremental \"%%%\""

bind-key    -T copy-mode    n                   send-keys -X search-again
bind-key    -T copy-mode    N                   send-keys -X search-reverse
bind-key    -T copy-mode    p                   send-keys -X search-reverse
bind-key    -T copy-mode    g                   command-prompt -p "(goto line)" "send -X goto-line \"%%%\""

# FZF session picker

bind-key    -T prefix       C-j                 display-popup -E "tmux list-windows -a | sed -E 's/\([0-9]* panes\).*$//' | grep -v \"^$(tmux display-message -p '#S')\$\" | fzf --reverse | xargs tmux switch-client -t"
bind-key    -T prefix       C-J                 display-popup -E "tmux list-sessions | sed -E 's/:.*$//' | grep -v \"^$(tmux display-message -p '#S')\$\" | fzf --reverse | xargs tmux switch-client -t"

# Print keybindings

bind-key -n                 C-S-p               run-shell "cat ~/.tmux.conf"

